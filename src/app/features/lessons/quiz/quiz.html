<div class="quiz-container">
  <div *ngIf="currentWord" class="quiz-content">
    <div class="question-section">
      <div class="question-text-wrapper">
        <div class="question-text-container">
          <button 
            class="help-btn" 
            (click)="requestWordHelp()" 
            *ngIf="shouldShowHelpButton()"
            [disabled]="isLoadingHelp"
            title="Obtenir de l'aide pour comprendre ce mot"
          >
            üí° Aide
          </button>
          <div class="question-text">{{ getQuestionText() }}</div>
        </div>
        <button 
          class="audio-btn" 
          (click)="playAudio()" 
          *ngIf="audioService.isSupported() && currentWord && ((direction === 'french_to_dutch' && currentWord.french_text) || (direction === 'dutch_to_french' && currentWord.dutch_text))"
        >
          üîä
        </button>
      </div>
    </div>

    <div class="choices-section">
      <div
        *ngFor="let choice of choices"
        class="choice-wrapper"
      >
        <button
          class="choice-btn"
          [class.selected]="selectedAnswer === choice"
          [class.correct]="showResult && choice === correctAnswer"
          [class.incorrect]="showResult && selectedAnswer === choice && !isCorrect"
          [disabled]="showResult"
          (click)="selectAnswer(choice)"
        >
          {{ choice }}
        </button>
        <div 
          *ngIf="showResult && selectedAnswer === choice && !isCorrect && selectedWordTranslation"
          class="choice-translation"
        >
          {{ selectedWordTranslation }}
        </div>
      </div>
    </div>

    <div class="navigation-buttons">
      <button class="btn-nav" (click)="previousQuestion()" [disabled]="currentIndex === 0">
        ‚Üê Pr√©c√©dent
      </button>
      <button class="btn-primary" (click)="nextQuestion()" *ngIf="currentIndex < words.length - 1 && !showResult">
        Suivant ‚Üí
      </button>
      <button 
        class="btn-primary" 
        (click)="nextQuestion()"
        *ngIf="currentIndex < words.length - 1 && showResult"
      >
        Question suivante ‚Üí
      </button>
    </div>

    <div *ngIf="showResult" class="result-section">
      <div class="score">
        Score : {{ score.correct }} / {{ score.total }}
      </div>

      <!-- Afficher le r√©sultat de la r√©ponse -->
      <div *ngIf="isCorrect" class="result-message correct-message">
        ‚úì Correct ! La bonne r√©ponse est : <strong>{{ correctAnswer }}</strong>
      </div>

      <div *ngIf="!isCorrect" class="result-message incorrect-message">
        ‚úó Incorrect. La bonne r√©ponse est : <strong>{{ correctAnswer }}</strong>
      </div>

      <div *ngIf="currentIndex === words.length - 1" class="completion-actions">
        <button 
          class="btn-primary" 
          (click)="completed.emit(score)"
        >
          Terminer le quiz
        </button>
        <button 
          class="btn-secondary" 
          (click)="reverseRequested.emit()"
        >
          üîÑ Refaire en {{ direction === 'french_to_dutch' ? 'n√©erlandais ‚Üí fran√ßais' : 'fran√ßais ‚Üí n√©erlandais' }}
        </button>
      </div>
    </div>

    <div *ngIf="!showResult" class="action-section">
      <div class="action-buttons">
        <button class="btn-skip-game" (click)="nextGameRequested.emit()">
          ‚è≠Ô∏è Passer au jeu suivant
        </button>
      </div>
    </div>
  </div>

  <div class="progress-bar" *ngIf="currentWord">
    <div class="progress-fill" [style.width.%]="((currentIndex + 1) / words.length) * 100"></div>
    <span class="progress-text">{{ currentIndex + 1 }} / {{ words.length }}</span>
  </div>

  <!-- Modal d'explication -->
  <div class="help-modal-overlay" *ngIf="showHelpExplanation" (click)="closeHelpExplanation()">
    <div class="help-modal" (click)="$event.stopPropagation()">
      <div class="help-modal-header">
        <h3>Explication du mot : {{ currentWord?.dutch_text }}</h3>
        <button class="close-btn" (click)="closeHelpExplanation()">√ó</button>
      </div>
      <div class="help-modal-content">
        <div *ngIf="isLoadingHelp" class="loading-help">
          <div class="spinner"></div>
          <p>Chargement de l'explication...</p>
        </div>
        <div *ngIf="helpError" class="error-help">
          <p>{{ helpError }}</p>
        </div>
        <div *ngIf="!isLoadingHelp && !helpError && helpExplanation" class="explanation-text">
          <p [innerHTML]="formatExplanation(helpExplanation)"></p>
        </div>
      </div>
    </div>
  </div>
</div>
