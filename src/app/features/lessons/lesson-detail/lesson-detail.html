<div class="lesson-detail-container">
  <div class="header">
    <button class="btn-back" routerLink="/lessons">Retour</button>
    <h1 *ngIf="lesson">{{ lesson.title }}</h1>
    <button 
      *ngIf="authService.getCurrentUser() && !isLoading && lesson" 
      class="btn-manage-words" 
      (click)="toggleWordManagement()"
    >
      {{ showWordManagement ? 'Masquer' : 'G√©rer mots' }}
    </button>
  </div>

  <div *ngIf="isLoading" class="loading">Chargement de la le√ßon...</div>

  <div *ngIf="!isLoading && lesson">

    <!-- Interface de gestion des mots -->
    <div *ngIf="showWordManagement && authService.getCurrentUser()" class="word-management-section">
      <h3>Gestion des mots de la le√ßon</h3>
      
      <!-- Liste des mots de la le√ßon -->
      <div class="words-list">
        <h4>Mots de la le√ßon ({{ allWordsInLesson.length }})</h4>
        <div class="word-item" *ngFor="let word of allWordsInLesson">
          <div class="word-content" [class.hidden]="isWordHidden(word.id)">
            <span class="word-french">{{ word.french_text }}</span>
            <span class="word-separator">‚Üí</span>
            <span class="word-dutch">{{ word.dutch_text }}</span>
            <span class="word-status" *ngIf="isWordHidden(word.id)">(Masqu√©)</span>
          </div>
          <div class="word-actions">
            <button 
              *ngIf="!isWordHidden(word.id)" 
              class="btn-hide" 
              (click)="hideWord(word.id)"
            >
              Masquer
            </button>
            <button 
              *ngIf="isWordHidden(word.id)" 
              class="btn-unhide" 
              (click)="unhideWord(word.id)"
            >
              R√©activer
            </button>
          </div>
        </div>
      </div>

      <!-- Ajouter un mot existant -->
      <div class="add-existing-word">
        <h4>Ajouter un mot existant</h4>
        <div class="available-words" *ngIf="availableWordsToAdd.length > 0">
          <div class="word-item" *ngFor="let word of availableWordsToAdd">
            <div class="word-content">
              <span class="word-french">{{ word.french_text }}</span>
              <span class="word-separator">‚Üí</span>
              <span class="word-dutch">{{ word.dutch_text }}</span>
            </div>
            <button class="btn-add" (click)="addExistingWordToLesson(word.id)">
              Ajouter
            </button>
          </div>
        </div>
        <p *ngIf="availableWordsToAdd.length === 0" class="no-words">
          Aucun mot disponible √† ajouter
        </p>
      </div>

      <!-- Cr√©er un nouveau mot -->
      <div class="add-new-word">
        <h4>Cr√©er un nouveau mot</h4>
        <div class="new-word-form">
          <input 
            type="text" 
            placeholder="Fran√ßais" 
            [(ngModel)]="newWordForm.french_text"
            class="word-input"
          />
          <span class="word-separator">‚Üí</span>
          <input 
            type="text" 
            placeholder="N√©erlandais" 
            [(ngModel)]="newWordForm.dutch_text"
            class="word-input"
          />
          <button class="btn-create" (click)="addNewWordToLesson()">
            Cr√©er et ajouter
          </button>
        </div>
      </div>
    </div>

    <!-- √âtape 1: Flashcards -->
    <div *ngIf="currentStep === 'flashcards' && flashcardWords.length > 0">
      <app-flashcard-view
        [word]="flashcardWords[currentFlashcardIndex]"
        [currentIndex]="currentFlashcardIndex"
        [totalWords]="flashcardWords.length"
        [direction]="flashcardDirection"
        (next)="onFlashcardNext()"
        (previous)="onFlashcardPrevious()"
        (finish)="onFlashcardsFinish()"
        (reverseRequested)="onFlashcardReverseRequested()"
        (nextGameRequested)="onFlashcardNextGameRequested()"
      ></app-flashcard-view>
    </div>

    <!-- √âtape 2: Quiz √† choix multiples -->
    <div *ngIf="currentStep === 'quiz'">
      <app-quiz
        [words]="quizWords"
        [direction]="quizDirection"
        (completed)="onQuizCompleted($event)"
        (reverseRequested)="onQuizReverseRequested()"
        (nextGameRequested)="onQuizNextGameRequested()"
      ></app-quiz>
    </div>

    <!-- √âtape 3: Pratique d'√©criture -->
    <div *ngIf="currentStep === 'typing'">
      <app-typing-practice
        [words]="typingWords"
        [direction]="typingDirection"
        (completed)="onTypingCompleted($event)"
        (reverseRequested)="onTypingReverseRequested()"
        (nextGameRequested)="onTypingNextGameRequested()"
      ></app-typing-practice>
    </div>

    <!-- √âtape 4: √âcriture en fran√ßais -->
    <div *ngIf="currentStep === 'frenchWriting'">
      <app-french-writing
        [words]="frenchWritingWords"
        [direction]="frenchWritingDirection"
        (completed)="onFrenchWritingCompleted($event)"
        (reverseRequested)="onFrenchWritingReverseRequested()"
        (nextGameRequested)="onFrenchWritingNextGameRequested()"
      ></app-french-writing>
    </div>

    <!-- √âtape 5: Phrases √† trous -->
    <div *ngIf="currentStep === 'fillInBlank'">
      <app-fill-in-the-blank
        [words]="fillInBlankWords"
        [direction]="fillInBlankDirection"
        (completed)="onFillInBlankCompleted($event)"
        (reverseRequested)="onFillInBlankReverseRequested()"
        (nextGameRequested)="onFillInBlankNextGameRequested()"
      ></app-fill-in-the-blank>
    </div>

    <!-- √âtape 5: Le√ßon compl√©t√©e -->
    <div *ngIf="currentStep === 'completed'" class="completion-screen">
      <div class="completion-content">
        <h2>üéâ F√©licitations !</h2>
        <p>Vous avez compl√©t√© la le√ßon "{{ lesson.title }}"</p>
        
        <div class="scores">
          <div class="score-card">
            <h3>Quiz</h3>
            <p class="score-value">{{ quizScore?.correct }} / {{ quizScore?.total }}</p>
          </div>
          <div class="score-card">
            <h3>√âcriture</h3>
            <p class="score-value">{{ typingScore?.correct }} / {{ typingScore?.total }}</p>
          </div>
          <div class="score-card">
            <h3>√âcriture fran√ßais</h3>
            <p class="score-value">{{ frenchWritingScore?.correct }} / {{ frenchWritingScore?.total }}</p>
          </div>
          <div class="score-card">
            <h3>Phrases √† trous</h3>
            <p class="score-value">{{ fillInBlankScore?.correct }} / {{ fillInBlankScore?.total }}</p>
          </div>
        </div>

        <div class="actions">
          <button class="btn-primary" routerLink="/lessons">Voir toutes les le√ßons</button>
          <button class="btn-secondary" (click)="restartLesson()">Recommencer</button>
        </div>
      </div>
    </div>
  </div>
</div>
