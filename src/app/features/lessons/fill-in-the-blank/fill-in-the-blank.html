<div class="fill-in-blank-container">
  <div class="progress-bar">
    <div class="progress-fill" [style.width.%]="((currentIndex + 1) / words.length) * 100"></div>
    <span class="progress-text">{{ currentIndex + 1 }} / {{ words.length }}</span>
  </div>

  <div *ngIf="isLoading" class="loading">GÃ©nÃ©ration des phrases...</div>

  <div *ngIf="!isLoading && currentSentence" class="fill-in-blank-content">
    <div class="question-section">
      <h3 class="question-label">ComplÃ©tez la phrase en Ã©crivant le mot manquant</h3>
      <div class="sentence-text">{{ getSentenceWithBlank() }}</div>
      <div *ngIf="direction === 'french_to_dutch'" class="help-hint">
        <span class="help-label">Aide :</span>
        <span class="help-word">{{ getCurrentWord()?.dutch_text }}</span>
      </div>
    </div>

    <div class="input-section">
      <div class="letter-counter" *ngIf="letterInputs.length > 0">
        Lettres correctes : {{ getCorrectLettersCount() }} / {{ getCorrectAnswer().length }}
      </div>
      <div class="letter-input-container" *ngIf="letterInputs.length > 0">
        <div 
          *ngFor="let letter of letterInputs; let i = index" 
          class="letter-wrapper"
        >
          <input
            type="text"
            class="letter-input"
            [class.correct]="getLetterStatus(i) === 'correct'"
            [class.incorrect]="getLetterStatus(i) === 'incorrect'"
            [data-letter-index]="i"
            [value]="letterInputs[i]"
            [disabled]="showResult"
            maxlength="1"
            (input)="onLetterInput(i, $event)"
            (keydown)="onKeyDown(i, $event)"
            [autofocus]="i === 0"
          />
          <div 
            class="letter-bar"
            [class.correct]="getLetterStatus(i) === 'correct'"
            [class.incorrect]="getLetterStatus(i) === 'incorrect'"
          ></div>
        </div>
      </div>
      <button 
        class="btn-check" 
        (click)="checkAnswer()"
        [disabled]="showResult || letterInputs.length === 0 || letterInputs.join('').trim().length === 0"
      >
        VÃ©rifier
      </button>
    </div>

    <div *ngIf="showResult" class="result-section">
      <div class="result-message" [class.correct]="isCorrect" [class.incorrect]="!isCorrect">
        <span *ngIf="isCorrect">âœ“ Correct !</span>
        <span *ngIf="!isCorrect">âœ— Incorrect. La bonne rÃ©ponse est : {{ direction === 'dutch_to_french' ? getCurrentWord()?.dutch_text : getCurrentWord()?.french_text }}</span>
      </div>
      
      <div class="score">
        Score : {{ score.correct }} / {{ score.total }}
      </div>

      <button 
        class="btn-primary" 
        (click)="nextQuestion()"
        *ngIf="currentIndex < words.length - 1"
      >
        Question suivante â†’
      </button>
      <div *ngIf="currentIndex === words.length - 1" class="completion-actions">
        <button 
          class="btn-primary" 
          (click)="completed.emit(score)"
        >
          Terminer l'exercice
        </button>
        <button 
          class="btn-secondary" 
          (click)="reverseRequested.emit()"
        >
          ðŸ”„ Refaire en {{ direction === 'dutch_to_french' ? 'franÃ§ais â†’ nÃ©erlandais' : 'nÃ©erlandais â†’ franÃ§ais' }}
        </button>
      </div>
    </div>
  </div>
</div>

