<div class="reorder-sentence-container">
  <div *ngIf="isLoading" class="loading">Chargement de la premiÃ¨re phrase...</div>
  
  <div *ngIf="isLoadingNext" class="loading-next">Chargement de la phrase suivante...</div>

  <div *ngIf="!isLoading && currentSentence" class="reorder-sentence-content">
    <div class="question-section">
      <div class="sentence-text-wrapper">
        <button 
          class="help-btn" 
          (click)="requestWordHelp()" 
          *ngIf="shouldShowHelpButton() && direction === 'dutch_to_french'"
          [disabled]="isLoadingHelp"
          title="Obtenir de l'aide pour comprendre ce mot"
        >
          ğŸ’¡ Aide
        </button>
        <div class="sentence-text">Remettez les mots dans le bon ordre</div>
        <button 
          class="audio-btn" 
          (click)="playAudio()" 
          *ngIf="audioService.isSupported() && currentSentence"
        >
          ğŸ”Š
        </button>
        <button 
          class="audio-btn audio-btn-french" 
          (click)="playTranslationAudio()" 
          *ngIf="audioService.isSupported() && currentSentence?.translation && direction === 'dutch_to_french'"
          title="Ã‰couter la traduction en franÃ§ais"
        >
          ğŸ‡«ğŸ‡·
        </button>
      </div>
      <div *ngIf="isAllCorrect() && currentSentence?.translation && direction === 'dutch_to_french'" class="translation-section">
        <div class="translation-label">Traduction :</div>
        <div class="translation-text">{{ currentSentence.translation }}</div>
      </div>
    </div>

    <div class="drag-drop-section">
      <!-- Tableau de dÃ©part (mots mÃ©langÃ©s) -->
      <div class="source-container">
        <h3 class="container-title">Mots disponibles</h3>
        <div 
          class="words-grid source-words"
          (dragover)="onDragOverSource($event)"
        >
          <div
            *ngFor="let word of sourceWords; let i = index"
            class="word-item source-word"
            draggable="true"
            (dragstart)="onDragStartFromSource($event, word, i)"
            (dragend)="onDragEnd($event)"
            (drop)="onDropSource($event, i)"
          >
            {{ word.text }}
          </div>
        </div>
      </div>

      <!-- Tableau final (ordre Ã  reconstruire) -->
      <div class="target-container">
        <h3 class="container-title">Reconstruisez la phrase</h3>
        <div class="words-grid target-words">
          <div
            *ngFor="let word of targetWords; let i = index"
            class="word-slot"
            [class.empty]="word === null"
            [class.correct]="getWordStatus(i) === 'correct'"
            [class.incorrect]="getWordStatus(i) === 'incorrect'"
            (dragover)="onDragOverTarget($event, i)"
            (drop)="onDropTarget($event, i)"
          >
            <div
              *ngIf="word !== null"
              class="word-item target-word"
              draggable="true"
              [class.correct]="getWordStatus(i) === 'correct'"
              [class.incorrect]="getWordStatus(i) === 'incorrect'"
              (dragstart)="onDragStartFromTarget($event, word, i)"
              (dragend)="onDragEnd($event)"
            >
              {{ word.text }}
            </div>
            <div *ngIf="word === null" class="empty-slot">
              <span class="drop-hint">DÃ©posez ici</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="navigation-buttons">
      <button class="btn-nav" (click)="previousQuestion()" [disabled]="currentIndex === 0 || isLoadingNext">
        â† PrÃ©cÃ©dent
      </button>
      <button 
        class="btn-primary" 
        (click)="nextQuestion()" 
        [disabled]="isLoadingNext || currentIndex >= words.length - 1"
      >
        <span *ngIf="!isLoadingNext">Suivant â†’</span>
        <span *ngIf="isLoadingNext">Chargement...</span>
      </button>
    </div>

    <div class="action-buttons">
      <button 
        *ngIf="canUseHelp()"
        class="btn-help" 
        (click)="requestHelp()"
        title="Obtenir de l'aide pour placer des mots supplÃ©mentaires"
      >
        ğŸ’¡ Obtenir de l'aide ({{ helpUsedCount }}/{{ maxHelpCount }})
      </button>
      <button 
        class="btn-skip-game" 
        (click)="nextGameRequested.emit()"
      >
        â­ï¸ Passer au jeu suivant
      </button>
    </div>

    <div *ngIf="currentIndex === words.length - 1 && isAllCorrect()" class="completion-section">
      <div class="score">
        Score : {{ score.correct + 1 }} / {{ score.total + 1 }}
      </div>
      <button 
        class="btn-primary" 
        (click)="finishExercise()"
      >
        Terminer l'exercice
      </button>
      <button 
        class="btn-secondary" 
        (click)="reverseRequested.emit()"
      >
        ğŸ”„ Refaire en {{ direction === 'dutch_to_french' ? 'franÃ§ais â†’ nÃ©erlandais' : 'nÃ©erlandais â†’ franÃ§ais' }}
      </button>
    </div>
  </div>

  <div class="progress-bar" *ngIf="!isLoading && currentSentence">
    <div class="progress-fill" [style.width.%]="((currentIndex + 1) / words.length) * 100"></div>
    <span class="progress-text">{{ currentIndex + 1 }} / {{ words.length }}</span>
  </div>

  <!-- Modal d'explication -->
  <div class="help-modal-overlay" *ngIf="showHelpExplanation" (click)="closeHelpExplanation()">
    <div class="help-modal" (click)="$event.stopPropagation()">
      <div class="help-modal-header">
        <h3>Explication du mot : {{ getDutchWordToExplain() }}</h3>
        <button class="close-btn" (click)="closeHelpExplanation()">Ã—</button>
      </div>
      <div class="help-modal-content">
        <div *ngIf="isLoadingHelp" class="loading-help">
          <div class="spinner"></div>
          <p>Chargement de l'explication...</p>
        </div>
        <div *ngIf="helpError" class="error-help">
          <p>{{ helpError }}</p>
        </div>
        <div *ngIf="!isLoadingHelp && !helpError && helpExplanation" class="explanation-text">
          <p [innerHTML]="formatExplanation(helpExplanation)"></p>
        </div>
      </div>
    </div>
  </div>
</div>

